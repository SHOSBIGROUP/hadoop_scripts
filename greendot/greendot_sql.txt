SELECT
  rim.division_nbr AS DIV_NO,
  rim.line_nbr AS LN_NO,
  rim.subline_nbr AS SBL_NO,
  rim.class_nbr AS CLS_NO,
  rim.item_nbr AS ITM_NO,
  rim.sku_nbr AS SKU_NO,
  loc.store_nbr AS LOC_NO,
  rim.status_cd AS PRD_STS,
  rim.age_cd AS AGE_IND,
  SUM(ima.cost_amt) AS COST_AMT,
  SUM(rim.current_sell_price_amt) AS CUR_SLL_PRC,
  SUM(rim.on_hand_qty) AS ON_HAND,
  rim.item_desc AS prd_ds

FROM fact.location_sho loc

JOIN raw.rim_inventory_history rim
  ON rim.store_nbr = loc.store_nbr

JOIN fact.ima_item_hierarchy ima
  ON rim.division_nbr = ima.division_nbr
  AND rim.item_nbr = ima.item_nbr
  AND rim.sku_nbr = ima.sku_nbr
  AND rim.line_nbr = ima.line_nbr
  AND rim.subline_nbr = ima.subline_nbr

WHERE rim.status_cd IN ('D', 'F', 'P', 'Q', 'L')

AND ((rim.division_nbr = '009'

AND rim.line_nbr IN ('24', '25', '33','45','88')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '009'

AND rim.line_nbr IN ('44','45','88')

AND rim.subline_nbr IN ('25')

AND rim.class_nbr IN ('005', '010', '015', '020',

'025', '030', '035', '040')

AND current_sell_price_amt >= 150)

OR (rim.division_nbr = '009'

AND rim.line_nbr IN ('49','45','88')

AND rim.subline_nbr IN ('02', '15', '18', '20',

'25', '28', '30', '40')

AND current_sell_price_amt >= 90)

OR (rim.division_nbr = '009'

AND rim.line_nbr IN ('51', '45','88')

AND rim.subline_nbr IN ('80', '85', '90', '91', '94')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '009'

AND rim.line_nbr IN ('52','45','88')

AND rim.subline_nbr IN ('05')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '020'

AND rim.line_nbr IN ('01', '08', '32', '34', '40')

AND current_sell_price_amt >= 19)

OR (rim.division_nbr = '020'

AND rim.line_nbr IN ('42')

AND rim.subline_nbr IN ('05', '25', '30')

AND current_sell_price_amt >= 19)

OR (rim.division_nbr = '022'

AND rim.line_nbr IN ('09', '15', '20', '21',

'22', '25', '28', '41')

AND current_sell_price_amt >= 30)

OR (rim.division_nbr = '022'

AND rim.line_nbr IN ('35')

AND rim.subline_nbr IN ('15')

AND current_sell_price_amt >= 30)

OR (rim.division_nbr = '025'

AND rim.line_nbr IN ('14', '19'))

OR (rim.division_nbr = '026'

AND rim.line_nbr IN ('01', '02', '04')

AND current_sell_price_amt >= 30)

OR (rim.division_nbr = '026'

AND rim.line_nbr IN ('03')

AND rim.subline_nbr IN ('15')

AND current_sell_price_amt >= 30)

OR (rim.division_nbr = '028'

AND rim.line_nbr IN ('36')

AND rim.subline_nbr IN ('20', '36')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '046'

AND rim.line_nbr IN ('01', '02', '04', '05', '51')

AND current_sell_price_amt >= 60)

OR (rim.division_nbr = '052'

AND rim.line_nbr IN ('13', '76', '80')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '057'

AND rim.line_nbr IN ('01', '04', '06')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '057'

AND rim.line_nbr IN ('09')

AND rim.subline_nbr IN ('20')

AND current_sell_price_amt >= 40)

OR (rim.division_nbr = '057'

AND rim.line_nbr IN ('17')

AND rim.subline_nbr IN ('05', '10', '15')

AND current_sell_price_amt >= 40)

OR (rim.division_nbr = '057'

AND rim.line_nbr IN ('32')

AND rim.subline_nbr IN ('25', '30')

AND current_sell_price_amt >= 40)

OR (rim.division_nbr = '071'

AND rim.line_nbr IN ('22', '23', '24', '25',

'44', '45', '46', '47',

'48', '81', '92')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '071'

AND rim.line_nbr IN ('28')

AND current_sell_price_amt >= 40)

OR (rim.division_nbr = '082'

AND rim.line_nbr IN ('20', '30', '35', '40')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '006'

AND rim.line_nbr IN ('06', '07', '08', '10',

'41', '42', '43', '64', '75')

AND current_sell_price_amt >= 100)

OR (rim.division_nbr = '025') 

OR (rim.division_nbr = '042'

AND rim.line_nbr IN ('03', '15')

AND current_sell_price_amt > 50))

AND rim.on_hand_qty > 0

AND loc.store_nbr IN (
'0001382',
'0001796',
'0001812',
'0001827',
'0001832',
'0001841',
'0001845',
'0001870',
'0001871',
'0001920',
'0001932',
'0001934',
'0002157',
'0002169',
'0002172',
'0002178',
'0002281',
'0002569',
'0002571',
'0002582',
'0002736',
'0002753',
'0002780',
'0003001',
'0003007',
'0003011',
'0003012',
'0003014',
'0003017',
'0003018',
'0003019',
'0003021',
'0003022',
'0003023',
'0003024',
'0003026',
'0003029',
'0003030',
'0003031',
'0003033',
'0003036',
'0003037',
'0003042',
'0003048',
'0003049',
'0003051',
'0003053',
'0003057',
'0003058',
'0003059',
'0003062',
'0003067',
'0003075',
'0003081',
'0003082',
'0003083',
'0003086',
'0003087',
'0003088',
'0003089',
'0003091',
'0003094',
'0003097',
'0003100',
'0003102',
'0003104',
'0003105',
'0003107',
'0003109',
'0003112',
'0003114',
'0003115',
'0003117',
'0003120',
'0003121',
'0003123',
'0003126',
'0003127',
'0003129',
'0003136',
'0003140',
'0003142',
'0003146',
'0003147',
'0003148',
'0003149',
'0003150',
'0003151',
'0003156',
'0003157',
'0003159',
'0003160',
'0003166',
'0003167',
'0003168',
'0003174',
'0003175',
'0003176',
'0003179',
'0003180',
'0003181',
'0003182',
'0003186',
'0003187',
'0003188',
'0003190',
'0003195',
'0003196',
'0003197',
'0003198',
'0003199',
'0003200',
'0003202',
'0003203',
'0003204',
'0003205',
'0003206',
'0003207',
'0003208',
'0003209',
'0003216',
'0003217',
'0003218',
'0003219',
'0003221',
'0003226',
'0003228',
'0003231',
'0003238',
'0003239',
'0003245',
'0003248',
'0003249',
'0003250',
'0003255',
'0003256',
'0003257',
'0003261',
'0003267',
'0003268',
'0003269',
'0003272',
'0003278',
'0003279',
'0003280',
'0003283',
'0003284',
'0003287',
'0003288',
'0003290',
'0003291',
'0003296',
'0003297',
'0003298',
'0003301',
'0003305',
'0003309',
'0003311',
'0003312',
'0003319',
'0003321',
'0003323',
'0003324',
'0003325',
'0003326',
'0003327',
'0003329',
'0003330',
'0003332',
'0003338',
'0003339',
'0003341',
'0003342',
'0003343',
'0003345',
'0003346',
'0003347',
'0003348',
'0003351',
'0003353',
'0003354',
'0003357',
'0003358',
'0003359',
'0003362',
'0003364',
'0003365',
'0003367',
'0003368',
'0003369',
'0003372',
'0003377',
'0003378',
'0003379',
'0003385',
'0003386',
'0003389',
'0003391',
'0003394',
'0003395',
'0003397',
'0003406',
'0003410',
'0003411',
'0003416',
'0003418',
'0003419',
'0003425',
'0003427',
'0003429',
'0003438',
'0003439',
'0003440',
'0003441',
'0003442',
'0003447',
'0003448',
'0003449',
'0003450',
'0003453',
'0003457',
'0003458',
'0003462',
'0003463',
'0003468',
'0003469',
'0003471',
'0003473',
'0003475',
'0003479',
'0003480',
'0003481',
'0003482',
'0003489',
'0003493',
'0003496',
'0003497',
'0003498',
'0003500',
'0003501',
'0003502',
'0003503',
'0003513',
'0003515',
'0003518',
'0003525',
'0003526',
'0003527',
'0003528',
'0003530',
'0003533',
'0003536',
'0003537',
'0003538',
'0003540',
'0003541',
'0003547',
'0003549',
'0003556',
'0003557',
'0003559',
'0003562',
'0003565',
'0003567',
'0003569',
'0003571',
'0003572',
'0003577',
'0003578',
'0003582',
'0003583',
'0003585',
'0003586',
'0003589',
'0003590',
'0003591',
'0003592',
'0003597',
'0003598',
'0003599',
'0003603',
'0003604',
'0003610',
'0003615',
'0003616',
'0003617',
'0003619',
'0003628',
'0003629',
'0003630',
'0003631',
'0003632',
'0003633',
'0003635',
'0003639',
'0003640',
'0003642',
'0003646',
'0003649',
'0003653',
'0003656',
'0003662',
'0003678',
'0003681',
'0003686',
'0003694',
'0003698',
'0003700',
'0003706',
'0003707',
'0003709',
'0003718',
'0003723',
'0003725',
'0003726',
'0003728',
'0003729',
'0003731',
'0003732',
'0003734',
'0003737',
'0003739',
'0003742',
'0003744',
'0003745',
'0003748',
'0003753',
'0003754',
'0003756',
'0003760',
'0003762',
'0003763',
'0003766',
'0003769',
'0003777',
'0003780',
'0003781',
'0003785',
'0003794',
'0003796',
'0003798',
'0003799',
'0003800',
'0003801',
'0003804',
'0003808',
'0003809',
'0003816',
'0003820',
'0003821',
'0003826',
'0003827',
'0003831',
'0003836',
'0003845',
'0003848',
'0003852',
'0003854',
'0003856',
'0003858',
'0003859',
'0003860',
'0003867',
'0003873',
'0003876',
'0003880',
'0003881',
'0003882',
'0003889',
'0003891',
'0003892',
'0003894',
'0003896',
'0003900',
'0003901',
'0003902',
'0003906',
'0003908',
'0003919',
'0003920',
'0003921',
'0003922',
'0003925',
'0003926',
'0003929',
'0003932',
'0003948',
'0003949',
'0003950',
'0003951',
'0003954',
'0003955',
'0003956',
'0003957',
'0003958',
'0003961',
'0003966',
'0003970',
'0003974',
'0003975',
'0003976',
'0003978',
'0003981',
'0003988',
'0003989',
'0003993',
'0003996',
'0003998',
'0003999',
'0004102',
'0004139',
'0004142',
'0004197',
'0004226',
'0004242',
'0004653',
'0004663',
'0004692',
'0004734',
'0004787',
'0004838',
'0004853',
'0004855',
'0004877',
'0004879',
'0004899',
'0004912',
'0004949',
'0005052',
'0005152',
'0005270',
'0005571',
'0005598',
'0005695',
'0005770',
'0006845',
'0006863',
'0006914',
'0006979',
'0006984',
'0007074',
'0007123',
'0007176',
'0007218',
'0007270',
'0007315',
'0007378',
'0007433',
'0007482',
'0007489',
'0007491',
'0007515',
'0007614',
'0007671',
'0007692',
'0007709',
'0007720',
'0007721',
'0007726',
'0007727',
'0007782',
'0007787',
'0007819',
'0007825',
'0007952',
'0007954',
'0009219',
'0009490',
'0009632',
'0009962',
'0001808',
'0001829',
'0001848',
'0001857',
'0001860',
'0001938',
'0001965',
'0002004',
'0003004',
'0003005',
'0003008',
'0003116',
'0004081',
'0004216',
'0004778',
'0005053',
'0005083',
'0005157',
'0005223',
'0005243',
'0005472',
'0005578',
'0005592',
'0005593',
'0005688',
'0005871',
'0006997',
'0007015',
'0007178',
'0007190',
'0007379',
'0007389',
'0009286',
'0009296'
)




AND rim.create_dt = '$Date'

GROUP BY rim.division_nbr,

         rim.line_nbr,

         rim.subline_nbr,

         rim.class_nbr,

         rim.item_nbr,

         rim.sku_nbr,

         loc.store_nbr,

         rim.status_cd,

         rim.age_cd,

         rim.item_desc
